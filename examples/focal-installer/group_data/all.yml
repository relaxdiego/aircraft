# TIP: To validate this file, run:
#
#     python group_data/all.py
#
# Any schema violations will be reported accordingly by pydantic

variables:
  pxe_server_address:  &pxe_server_address   '192.168.86.43'
  pxe_server_port:     &pxe_server_port      8080
  tftp_server_address: &tftp_server_address  '192.168.86.43'
  dhcp_interfaces:     &dhcp_interfaces      ['eth0']
  dhcp_subnet:         &dhcp_subnet          '192.168.100.0/24'
  dhcp_address_ranges: &dhcp_address_ranges  [{start: '192.168.100.200', end: '192.168.100.254'}]
  dns_servers:         &dns_server_addresses ['1.1.1.1', '8.8.8.8', '192.168.86.1']
  gateway4_address:    &gateway4_address     '192.168.100.1'

  machine_1_name:      &machine_1_name       'pxe-client-1'
  machine_1_address:   &machine_1_address    '192.168.100.11/24'

  # focal
  bootfiles:    &bootfiles
    - client_arch:      7
      image_source_url: 'http://archive.ubuntu.com/ubuntu/dists/focal/main/uefi/grub2-amd64/2.04-1ubuntu26/grubnetx64.efi.signed'
      image_sha256sum:  '279a5a755bc248d22799434a261b92698740ab817d8aeccbd0cb7409959a1463'
  installer:    &installer
    type:             'autoinstall-v1'
    image_source_url: 'https://releases.ubuntu.com/20.04.1/ubuntu-20.04.1-live-server-amd64.iso'
    image_sha256sum:  '443511f6bf12402c12503733059269a2e10dec602916c0a75263e5d990f6bb93'


http: &http
  hostname:      *pxe_server_address
  port:          *pxe_server_port
  root_dir:      '/volume4/pxe/http'
  sftp_root_dir: '/pxe/http'


dnsmasq:
  interfaces: *dhcp_interfaces

  dhcp:
    subnet:           *dhcp_subnet
    ranges:           *dhcp_address_ranges
    router:           *gateway4_address
    dns_servers:      *dns_server_addresses
    tftp_server_name: *tftp_server_address
    bootfiles:        *bootfiles

  tftp: &tftp
    hostname:      *tftp_server_address
    root_dir:      '/volume4/pxe/tftpboot'
    sftp_root_dir: '/pxe/tftpboot'


pxe:
  tftp: *tftp
  http: *http

  bootfiles: *bootfiles
  installer: *installer

  machines:
    - hostname: *machine_1_name
      network:
        ethernets:
          - name: 'eno1'
            dhcp4: false
            addresses:
              - *machine_1_address
            nameservers:
              addresses: *dns_server_addresses
            gateway4:    *gateway4_address

      storage:
        disks:
          - path: '/dev/sda'
            partitions:
              - size: 536870912  # 512MB
                format: 'fat32'
                mount_path: '/boot/efi'
                flag: 'boot'
                grub_device: true

              - size: 1073741824  # 1GB
                format: 'ext4'
                mount_path: '/boot'

              - id: 'partition-for-ubuntu-vg'
                size: 429496729600  # 400GB

        lvm_volgroups:
          - name: 'ubuntu-vg'
            devices:
              - partition-for-ubuntu-vg
            logical_volumes:
              - name: 'ubuntu-lv'
                size: 397284474880  # 370GB
                format: 'ext4'
                mount_path: '/'
